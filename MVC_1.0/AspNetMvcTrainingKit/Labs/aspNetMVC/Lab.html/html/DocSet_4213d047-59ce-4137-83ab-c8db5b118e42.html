<html dir="ltr" xmlns:MSHelp="http://msdn.microsoft.com/mshelp" xmlns:dt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882" xmlns:xlink="http://www.w3.org/1999/xlink">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta name="save" content="history" />
    <xml>
      <MSHelp:TOCTitle Title="Appendix" />
      <MSHelp:RLTitle Title="Appendix" />
      <MSHelp:Attr Name="DocSet" Value="docSet" />
      <MSHelp:Attr Name="TopicType" Value="kbOrient" />
      <MSHelp:Attr Name="Locale" Value="kbEnglish" />
      <MSHelp:Attr Name="AssetId" Value="{GUID}" />
    </xml>
    <title>Appendix</title>
    <link rel="stylesheet" type="text/css" href="../local/Classic.css" />
    <script src="../local/EventUtilities.js" type="text/jscript" language="jscript"> </script>
    <script src="../local/SplitScreen.js" type="text/jscript" language="jscript"> </script>
    <script src="../local/Dropdown.js" type="text/jscript" language="jscript"> </script>
    <script src="../local/script.js" type="text/jscript" language="jscript"> </script>
  </head>
  <body>
    <input type="hidden" id="userDataCache" class="userDataStyle" />
    <input type="hidden" id="hiddenScrollOffset" />
    <img id="dropDownImage" style="display:none; height:0; width:0;" alt="DropDown image" src="../local/drpdown.gif" />
    <img id="dropDownHoverImage" style="display:none; height:0; width:0;" alt="DropDownHover image" src="../local/drpdown_orange.gif" />
    <img id="collapseImage" style="display:none; height:0; width:0;" alt="Collapse image" src="../local/collapse_all.gif" />
    <img id="expandImage" style="display:none; height:0; width:0;" alt="Expand image" src="../local/expand_all.gif" />
    <img id="collapseAllImage" style="display:none; height:0; width:0;" alt="CollapseAll image" src="../local/collall.gif" />
    <img id="expandAllImage" style="display:none; height:0; width:0;" alt="ExpandAll image" src="../local/expall.gif" />
    <img id="copyImage" style="display:none; height:0; width:0;" alt="Copy image" src="../local/copycode.gif" />
    <img id="copyHoverImage" style="display:none; height:0; width:0;" alt="CopyHover image" src="../local/copycodeHighlight.gif" />
    <div id="header">
      <table width="100%" id="topTable">
        <tr id="headerTableRow1">
          <td align="left">
            <span id="runningHeaderText">Introduction to ASP.NET MVC</span>
          </td>
        </tr>
        <tr id="headerTableRow2">
          <td align="left">
            <span id="nsrTitle">Appendix</span>
          </td>
        </tr>
        <tr id="headerTableRow3">
          <td />
        </tr>
      </table>
    </div>
    <div id="mainSection">
      <div id="mainBody">
        <div id="allHistory" class="saveHistory" onsave="saveAll()" onload="loadAll()" />
        <a name="_Toc190837092" href="#">
          <span />
        </a>
        <a name="_Toc205281208" href="#">
          <span />
        </a>
        <a name="_Toc223344232" href="#">
          <span />
        </a>
        <a name="_Toc224707094" href="#">
          <span />
        </a>
        <p>
          <b>Moq Library</b>
        </p>
        <p>It is a library that allows you, among other things, to create mock objects and set their expected behavior in an easy way.</p>
        <p>The <b>GetRouteDataForUrl</b> method used in this exercise works in the following way.</p>
        <div class="code">
          <span codeLanguage="CSharp">
            <table width="100%" cellspacing="0" cellpadding="0">
              <tr>
                <th>C#</th>
                <th>
                  <span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0">
                    <img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span>
                </th>
              </tr>
              <tr>
                <td colspan="2">
                  <pre>private static RouteData GetRouteDataForUrl(RouteCollection routes, string url){    var mockRequest = new Mock&lt;HttpRequestBase&gt;();    mockRequest.Setup(r =&gt; r.AppRelativeCurrentExecutionFilePath).Returns(url);    mockRequest.Setup(r =&gt; r.PathInfo).Returns(String.Empty);    var mockContext = new Mock&lt;HttpContextBase&gt;();    mockContext.Setup(c =&gt; c.Request).Returns(mockRequest.Object);    RouteData routeData = routes.GetRouteData(mockContext.Object);    return routeData;}</pre>
                </td>
              </tr>
            </table>
          </span>
        </div>
        <br />
        <ol>
          <li>The first thing is to create your mock object, which is done using the <b>Mock&lt;T&gt;</b> class. You need to create a mock request object that will allow faking an HTTP request.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>var mockRequest = new Mock&lt;HttpRequestBase&gt;();</pre></td></tr></table></span></div><br /></li>
          <li>Now that you have the mock request, you will set up some of the behavior you need out of the request. This includes making sure that the fake request appears to be asking for the URL passed into the method.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>mockRequest.Setup(r =&gt; r.AppRelativeCurrentExecutionFilePath).Returns(url);mockRequest.Setup(r =&gt; r.PathInfo).Returns(String.Empty);</pre></td></tr></table></span></div><br /></li>
          <li>Now that you have the mock request configured, you need to create a mock HTTP context and assign the mock request to it.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>var mockContext = new Mock&lt;HttpContextBase&gt;();mockContext.Setup(c =&gt; c.Request).Returns(mockRequest.Object);</pre></td></tr></table></span></div><br /></li>
          <li>Finally, with the mock context, you can request the route data from the passed in <b>RouteCollection</b> using the mock context.<div class="code"><span codeLanguage="CSharp"><table width="100%" cellspacing="0" cellpadding="0"><tr><th>C#</th><th><span class="copyCode" onclick="CopyCode(this)" onkeypress="CopyCode_CheckKey(this)" onmouseover="ChangeCopyCodeIcon(this)" onfocusin="ChangeCopyCodeIcon(this)" onmouseout="ChangeCopyCodeIcon(this)" onfocusout="ChangeCopyCodeIcon(this)" tabindex="0"><img class="copyCodeImage" name="ccImage" align="absmiddle" src="../local/copycode.gif" />Copy Code
                  </span></th></tr><tr><td colspan="2"><pre>RouteData routeData = routes.GetRouteData(mockContext.Object);return routeData;</pre></td></tr></table></span></div></li>
        </ol>
      </div>
      <div id="footer">
        <div class="footerLine">
          <img src="../local/footer.gif" alt="Footer image" width="100%" height="3px" />
        </div>To give feedback please write to mvckit@microsoft.com<p />Copyright Â© 2009 by Microsoft Corporation. All rights reserved.</div>
    </div>
  </body>
</html>